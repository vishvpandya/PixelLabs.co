<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PixelLabs</title>
<style>
/* ===== Theme with your palette ===== */
:root{
  --bg:#F4F1E8;
  --text:#1F2E27;
  --muted:#5E6B66;
  --card:#FBF8F1;
  --accent:#B5965C;
  --gold:#B5965C;
  --border:#E5DFD2;
}
.dark{
  --bg:#0F1412;
  --text:#EDEBE6;
  --muted:#A7B0AB;
  --card:#171D1A;
  --accent:#B5965C;
  --gold:#B5965C;
  --border:#26302B;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:#006241;font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,"Helvetica Neue",Arial;}
.header{position:sticky;top:0;background:var(--bg);border-bottom:1px solid var(--border);z-index:20}
.container{max-width:1100px;margin:0 auto;padding:16px}
.flex{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.brand{
  display:flex;align-items:center;gap:8px;
  font-weight:700;font-size:20px;color:var(--text)
}
.brand .logo{height:32px;width:auto}
.brand .name{color:var(--text)}
.brand .co{color:var(--gold)}
.search{flex:1;min-width:180px}
input,select,button,textarea{border:1px solid var(--border);background:var(--card);color:var(--text);padding:10px;border-radius:10px;outline:none}
button{cursor:pointer}
.btn{background:var(--accent);color:white;border:none}
.grid{display:grid;grid-template-columns: repeat(auto-fill, minmax(220px,1fr));gap:16px;margin-top:16px}
.card{border:1px solid var(--border);border-radius:16px;overflow:hidden;background:var(--card);display:flex;flex-direction:column}
.card img{width:100%;height:170px;object-fit:cover;background:#ddd;cursor:pointer}
.card .p{padding:12px;display:flex;flex:1;flex-direction:column}
.price{font-weight:700;margin-top:6px;color:var(--gold)}
.small{font-size:12px;color:var(--muted)}
.badge{display:inline-block;padding:2px 8px;border-radius:20px;border:1px solid var(--border);font-size:12px;margin-top:6px;color:var(--muted)}
.actions{margin-top:auto;display:flex;gap:8px;flex-wrap:wrap}
.iconbtn{display:inline-flex;align-items:center;gap:6px}
.count-badge{position:relative}
.count-badge .count{position:absolute;top:-6px;right:-6px;background:#ff3b30;color:#fff;border-radius:999px;font-size:11px;padding:2px 6px}
.toggle{width:40px;height:40px;display:grid;place-items:center;border-radius:10px;background:var(--card)}
.drawer{position:fixed;inset:0;display:none}
.drawer.open{display:block}
.backdrop{position:absolute;inset:0;background:rgba(0,0,0,.4)}
.panel{position:absolute;right:0;top:0;bottom:0;width:380px;max-width:92vw;background:var(--bg);border-left:1px solid var(--border);display:flex;flex-direction:column}
.panel header, .panel footer{padding:12px;border-bottom:1px solid var(--border)}
.panel footer{border-top:1px solid var(--border);border-bottom:none}
.items{padding:12px;flex:1;overflow:auto;display:flex;flex-direction:column;gap:10px}
.cart-item{display:grid;grid-template-columns:64px 1fr auto;gap:10px;align-items:center;border:1px solid var(--border);border-radius:12px;padding:8px;background:var(--card)}
.cart-item img{width:64px;height:70px;object-fit:cover;border-radius:8px}
.qty{display:flex;align-items:center;gap:6px}
.qty button{width:28px;height:28px;border-radius:8px}
.row{display:flex;justify-content:space-between;margin:6px 0;color:var(--muted)}
.total{font-weight:800;font-size:18px;color:var(--text)}
.coupon{display:flex;gap:8px}
.notice{font-size:12px;color:var(--muted);margin-top:8px}
.tag{border:1px dashed var(--border);padding:2px 6px;border-radius:6px;font-size:11px}
.modal{position:fixed;inset:0;display:none}
.modal.open{display:block}
.modal .backdrop{background:rgba(0,0,0,.5)}
.dialog{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:960px;max-width:95vw;background:var(--bg);border:1px solid var(--border);border-radius:16px;overflow:hidden}
.dialog header, .dialog footer{padding:12px;border-bottom:1px solid var(--border)}
.dialog footer{border-top:1px solid var(--border);border-bottom:none;display:flex;justify-content:flex-end;gap:8px}
.dialog .body{padding:12px}
.row2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.success{padding:10px;background:#00c85322;border:1px solid #00c85355;border-radius:10px;color:#00c853}
hr{border:none;border-top:1px solid var(--border);margin:10px 0}
footer.site{margin:40px 0;color:var(--muted);text-align:center}

/* ===== Product modal gallery ===== */
.gallery{display:flex;flex-direction:column;gap:10px}
.gallery .main{
  position:relative;background:#ddd;border-radius:12px;overflow:hidden;height:420px;display:grid;place-items:center
}
.gallery .main img{width:50%;height:100%;object-fit:contain}
.navbtn{
  position:absolute;top:50%;transform:translateY(-50%);border:none;background:rgba(0,0,0,.35);
  color:#fff;width:36px;height:36px;border-radius:999px;display:grid;place-items:center
}
.navbtn.left{left:8px} .navbtn.right{right:8px}
/* Back button inside product modal image */
.backbtn{
  position:absolute; top:10px; left:10px;
  width:36px; height:36px; border:none; border-radius:999px;
  display:grid; place-items:center; background:rgba(0,0,0,.5);
  color:#fff; font-size:18px; line-height:1; cursor:pointer; z-index:3;
}
.backbtn:focus-visible{outline:2px solid #fff; outline-offset:2px;}

.thumbs{display:flex;gap:8px;overflow:auto;padding-bottom:4px}
.thumbs img{
  width:80px;height:80px;object-fit:cover;border-radius:10px;border:2px solid transparent;cursor:pointer;background:#eee
}
.thumbs img.active{border-color:var(--accent);box-shadow:0 0 0 2px rgba(0,0,0,.03)}
.stock{display:flex;align-items:center;gap:6px;color:#2e7d32;font-weight:600}
.stock .dot{width:10px;height:10px;background:#24c03e;border-radius:999px;display:inline-block}
.pmeta{display:flex;gap:8px;flex-wrap:wrap}
.pmeta .chip{background:var(--card);border:1px solid var(--border);padding:2px 8px;border-radius:999px;font-size:12px;color:var(--muted)}
.pactions{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap}
.whatsapp{background:#1c1c1c;color:#fff;border:none;border-radius:10px;padding:12px 16px}
.sharebtn{width:40px;height:40px;border-radius:10px;border:1px solid var(--border);background:var(--card)}
.titlelg{font-size:28px;font-weight:800;line-height:1.25}

/* ====== RESPONSIVE: comfortable on phones, tablets, laptops ====== */
@media (max-width: 1024px){
  .dialog{width:92vw;max-width:92vw}
  .gallery .main{height:56vh}
}
@media (max-width: 768px){
  .container{padding:12px}
  .flex{gap:8px}
  .brand{flex:1}
  /* Controls wrap to full width rows */
  .search, #category, #sort, #themeToggle, #cartBtn{flex:1 1 10%}
  .search{min-width:0}

  /* Modal becomes full-screen and scrollable */
  .dialog{
    left:0; top:0; transform:none;
    width:100vw; max-width:100vw; height:100vh;
    border-radius:0; border-left:none; border-right:none;
  }
  .dialog header{position:sticky;top:0;background:var(--bg);z-index:2}
  .dialog .body{height:calc(100vh - 56px);overflow:auto;padding-bottom:12px}

  /* Stack gallery above details for comfort on narrow screens */
  #pm_body{display:grid;grid-template-columns:1fr;gap:16px}
  .gallery .main{height:54vh}
  .thumbs img{width:70px;height:70px}

  /* Buttons easier to tap */
  .pactions{flex-direction:column}
  .btn,.whatsapp{width:100%}
  .titlelg{font-size:24px}
  .card img{height:200px}
}

/* Very small phones */
@media (max-width: 420px){
  .brand .name{font-size:18px}
  .thumbs img{width:64px;height:64px}
  .titlelg{font-size:22px}
  .card img{height:180px}
}
</style>
</head>
<body>
<header class="header">
  <div class="container flex">
    <!-- Brand with logo + name -->
    <div class="brand" id="brand">
      <img src="logo.jpg" alt="PixelLabs Logo" class="logo">
      <span class="name">PixelLabs<span class="co">.CO</span></span>
    </div>
    <input id="search" class="search" placeholder="Search products…"/>
    <select id="category">
      <option value="">All categories</option>
    </select>
    <select id="sort">
      <option value="featured">Featured</option>
      <option value="price-asc">Price: Low to High</option>
      <option value="price-desc">Price: High to Low</option>
      <option value="name-asc">Name: A → Z</option>
    </select>
    <button id="themeToggle" class="toggle" title="Toggle theme" aria-label="Toggle theme">
      <span id="themeIcon">🌞</span>
    </button>
    <button id="cartBtn" class="iconbtn count-badge btn" aria-label="Open cart">
      🛒 <span>Cart</span><span class="count" id="cartCount">0</span>
    </button>
  </div>
</header>

<main class="container">
  <div id="productGrid" class="grid" aria-live="polite"></div>
  <p class="notice">Tip: coupon codes <span class="tag">WELCOME10</span> (10% off) or <span class="tag">FREESHIP</span> (free shipping).</p>
</main>

<!-- Cart Drawer -->
<div id="drawer" class="drawer" role="dialog" aria-modal="true" aria-label="Shopping cart">
  <div class="backdrop" id="drawerClose"></div>
  <div class="panel">
    <header class="flex" style="justify-content:space-between">
      <strong>🛒 Your Cart</strong>
      <button id="emptyCart">Empty</button>
    </header>
    <div id="cartItems" class="items"></div>
    <footer>
      <div class="coupon">
        <input id="couponInput" placeholder="Coupon code"/>
        <button id="applyCoupon" class="btn">Apply</button>
      </div>
      <div class="row"><span>Subtotal</span><span id="subtotal">₹0</span></div>
      <div class="row"><span>Shipping</span><span id="shipping">₹0</span></div>
      <div class="row"><span>Discount</span><span id="discount">- ₹0</span></div>
      <div class="row total"><span>Total</span><span id="grandTotal">₹0</span></div>
      <button id="checkout" class="btn" style="width:100%;margin-top:10px">Checkout</button>
      <p class="notice">Secure checkout via <b>COD / WhatsApp</b> by default. Optional Razorpay supported if you add your key.</p>
    </footer>
  </div>
</div>

<!-- Checkout Modal (unchanged) -->
<div id="checkoutModal" class="modal" role="dialog" aria-modal="true" aria-label="Checkout form">
  <div class="backdrop" id="closeCheckout"></div>
  <div class="dialog">
    <header class="flex" style="justify-content:space-between">
      <strong>Checkout</strong>
      <button id="xCheckout">✖</button>
    </header>
    <div class="body">
      <div class="row2">
        <div><label>Name<br><input id="c_name" required></label></div>
        <div><label>Phone<br><input id="c_phone" required></label></div>
      </div>
      <label>Address<br><textarea id="c_address" rows="3" required></textarea></label>
      <div class="row2">
        <div><label>City<br><input id="c_city" required></label></div>
        <div><label>Pincode<br><input id="c_pin" required></label></div>
      </div>
      <div>
        <label>Payment Method</label><br>
        <label><input type="radio" name="pay" value="cod" checked> Cash on Delivery / WhatsApp</label>
        <label style="margin-left:14px"><input type="radio" name="pay" value="rzp"> Razorpay (card/UPI)</label>
      </div>
      <div id="orderSummary"></div>
      <div id="checkoutMsg" class="success" style="display:none">Order placed! Check your WhatsApp.</div>
    </div>
    <footer>
      <button id="placeOrder" class="btn">Place Order</button>
      <button id="cancelOrder">Cancel</button>
    </footer>
  </div>
</div>

<!-- Product Modal -->
<div id="productModal" class="modal" role="dialog" aria-modal="true" aria-label="Product details">
  <div class="backdrop" id="closeProduct"></div>
  <div class="dialog">
    <header class="flex" style="justify-content:space-between">
      <strong id="pm_title">Product</strong>
      <button id="xProduct">✖</button>
    </header>
    <div class="body">
      <div class="row2" id="pm_body"></div>
    </div>
  </div>
</div>

<footer class="site">
  <div>© <span id="year"></span> PixelLabs — built free & fast.</div>
</footer>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
// ====== CONFIG ======
const STORE_NAME = "PixelLabs";
const CURRENCY = "₹";
const SHIPPING_BASE = 49; // 0 if FREESHIP
const OWNER_WHATSAPP = "918490011123";
const RAZORPAY_KEY = "";

/* ========= PRODUCTS ========= */
const PRODUCTS = [
  {
    id:1,
    name:"Rolex Men's Skeleton Automatic – Custom Design Edition! ",
    price:14999,
    stock:99,
    category:"Watch",
    images:[
      "WhatsApp Image 2025-08-18 at 16.53.23_f677067d.jpg",
      "WhatsApp Image 2025-08-18 at 16.53.24_9a088815.jpg",
      "WhatsApp Image 2025-08-18 at 16.53.23_f677067d.jpg",
      "WhatsApp Image 2025-08-18 at 16.53.24_e630e59d.jpg",
      "WhatsApp Image 2025-08-18 at 16.53.23_f677067d.jpg"
    ]
  },
  {
    id:2,
    name:"shirt pant combination",
    price:1299,
    stock:34,
    category:"clothe",
    images:[
      "WhatsApp Image 2025-08-18 at 16.54.23_b271f1fc.jpg",
      "WhatsApp Image 2025-08-18 at 16.54.24_85748ece.jpg",
      "WhatsApp Image 2025-08-18 at 16.54.23_b271f1fc.jpg"
    ]
  },
  {
    id:3,
    name:"Smart Watch",
    price:1999,
    stock:50,
    category:"Electronics",
    images:[
      "https://images.unsplash.com/photo-1517433456452-f9633a875f6f?q=80&w=1600&auto=format&fit=crop",
      "https://images.unsplash.com/photo-1517935706615-2717063c2225?q=80&w=1600&auto=format&fit=crop"
    ]
  },
  {
    id:4,
    name:"Travel Backpack",
    price:1799,
    stock:23,
    category:"Fashion",
    images:[
      "https://images.unsplash.com/photo-1553062407-98eeb64c6a62?q=80&w=1600&auto=format&fit=crop",
      "https://images.unsplash.com/photo-1520607162513-77705c0f0d4a?q=80&w=1600&auto=format&fit=crop"
    ]
  }
];

// ====== STATE ======
let state = {
  theme: localStorage.getItem("theme") || "light",
  cart: JSON.parse(localStorage.getItem("cart")||"[]"),
  coupon: JSON.parse(JSON.stringify(localStorage.getItem("coupon") || "")),
  viewing: null,
  imgIndex: 0
};
const el = sel => document.querySelector(sel);

// ====== INIT ======
document.getElementById("year").textContent = new Date().getFullYear();

// Theme
function applyTheme(){
  if(state.theme === "dark"){ document.body.classList.add("dark"); el("#themeIcon").textContent="🌙"; }
  else { document.body.classList.remove("dark"); el("#themeIcon").textContent="🌞"; }
  localStorage.setItem("theme", state.theme);
}
el("#themeToggle").onclick = ()=>{ state.theme = state.theme==="dark"?"light":"dark"; applyTheme(); }
applyTheme();

// Categories
const cats = [...new Set(PRODUCTS.map(p=>p.category))];
const catSelect = el("#category");
cats.forEach(c=>{
  const o = document.createElement("option");
  o.value=c; o.textContent=c;
  catSelect.appendChild(o);
});

// Render products
function formatCurrency(n){ return CURRENCY + n.toLocaleString("en-IN"); }
function cover(p){ return (p.images && p.images.length)? p.images[0] : ""; }

function renderProducts(){
  const grid = el("#productGrid");
  const q = el("#search").value.toLowerCase().trim();
  const cat = catSelect.value;
  const sort = el("#sort").value;

  let list = PRODUCTS.filter(p=>{
    const matchQ = !q || p.name.toLowerCase().includes(q);
    const matchC = !cat || p.category===cat;
    return matchQ && matchC;
  });
  if(sort==="price-asc") list.sort((a,b)=>a.price-b.price);
  if(sort==="price-desc") list.sort((a,b)=>b.price-a.price);
  if(sort==="name-asc") list.sort((a,b)=>a.name.localeCompare(b.name));

  grid.innerHTML = "";
  list.forEach(p=>{
    const card = document.createElement("div");
    card.className="card";
    card.innerHTML = `
      <img src="${cover(p)}" alt="${p.name}" data-view="${p.id}">
      <div class="p">
        <div><strong>${p.name}</strong></div>
        <div class="small">${p.category}</div>
        <div class="price">${formatCurrency(p.price)}</div>
        <div class="actions">
          <button class="btn" data-add="${p.id}">Add to cart</button>
          <button data-buy="${p.id}">Buy now</button>
          <button data-view="${p.id}">View</button>
        </div>
      </div>`;
    grid.appendChild(card);
  });
}
["#search","#category","#sort"].forEach(s=> el(s).addEventListener("input", renderProducts));
renderProducts();

// Cart helpers
function saveCart(){ localStorage.setItem("cart", JSON.stringify(state.cart)); updateCartCount(); renderCart(); }
function updateCartCount(){ const count = state.cart.reduce((s,i)=>s+i.qty,0); el("#cartCount").textContent = count; }
function addToCart(id, qty=1){
  const p = PRODUCTS.find(x=>x.id===id);
  if(!p) return;
  const existing = state.cart.find(x=>x.id===id);
  if(existing) existing.qty += qty;
  else state.cart.push({id:p.id,name:p.name,price:p.price,img:cover(p),qty});
  saveCart();
}
function removeFromCart(id){ state.cart = state.cart.filter(x=>x.id!==id); saveCart(); }
function changeQty(id, delta){
  const it = state.cart.find(x=>x.id===id);
  if(!it) return;
  it.qty += delta;
  if(it.qty<=0) removeFromCart(id); else saveCart();
}

document.addEventListener("click",(e)=>{
  const add = e.target.closest("[data-add]");
  const buy = e.target.closest("[data-buy]");
  const view = e.target.closest("[data-view]");
  const dec = e.target.closest("[data-dec]");
  const inc = e.target.closest("[data-inc]");
  const rem = e.target.closest("[data-remove]");

  if(add){ addToCart(Number(add.getAttribute("data-add"))); toast("Added to cart"); }
  if(buy){ addToCart(Number(buy.getAttribute("data-buy"))); openDrawer(); openCheckout(); }
  if(view){ openProduct(Number(view.getAttribute("data-view"))); }
  if(dec){ changeQty(Number(dec.getAttribute("data-dec")), -1); }
  if(inc){ changeQty(Number(inc.getAttribute("data-inc")), +1); }
  if(rem){ removeFromCart(Number(rem.getAttribute("data-remove"))); }
});

// Drawer
function openDrawer(){ el("#drawer").classList.add("open"); renderCart(); }
function closeDrawer(){ el("#drawer").classList.remove("open"); }
el("#cartBtn").onclick = openDrawer;
el("#drawerClose").onclick = closeDrawer;
el("#emptyCart").onclick = ()=>{ state.cart=[]; saveCart(); };

// Coupon + totals
function calcTotals(){
  const subtotal = state.cart.reduce((s,i)=>s+i.price*i.qty,0);
  const shipping = state.coupon==="FREESHIP" || subtotal===0 ? 0 : SHIPPING_BASE;
  let discount = 0;
  if(state.coupon==="WELCOME10") discount = Math.round(subtotal*0.10);
  const total = Math.max(0, subtotal + shipping - discount);
  return {subtotal, shipping, discount, total};
}
function renderCart(){
  const wrap = el("#cartItems");
  if(state.cart.length===0){ wrap.innerHTML = `<p class="small">Your cart is empty.</p>`; }
  else {
    wrap.innerHTML = "";
    state.cart.forEach(i=>{
      const item = document.createElement("div");
      item.className="cart-item";
      item.innerHTML = `
        <img src="${i.img}" alt="${i.name}">
        <div>
          <div><strong>${i.name}</strong></div>
          <div class="small">${formatCurrency(i.price)}</div>
          <div class="qty" style="margin-top:6px">
            <button data-dec="${i.id}">-</button>
            <span>${i.qty}</span>
            <button data-inc="${i.id}">+</button>
            <button data-remove="${i.id}" style="align:center">Remove</button>
          </div>
        </div>
        <div style="font-weight:700">${formatCurrency(i.price*i.qty)}</div>
      `;
      wrap.appendChild(item);
    });
  }
  const t = calcTotals();
  el("#subtotal").textContent = formatCurrency(t.subtotal);
  el("#shipping").textContent = formatCurrency(t.shipping);
  el("#discount").textContent = "- " + formatCurrency(t.discount);
  el("#grandTotal").textContent = formatCurrency(t.total);
  el("#couponInput").value = state.coupon || "";
}
el("#applyCoupon").onclick = ()=>{
  const c = el("#couponInput").value.trim().toUpperCase();
  if(["WELCOME10","FREESHIP",""].includes(c)){
    state.coupon = c; localStorage.setItem("coupon", c); renderCart();
    toast(c? `Coupon ${c} applied` : "Coupon cleared");
  } else toast("Invalid coupon");
};
updateCartCount(); renderCart();

// Checkout (unchanged)
function openCheckout(){
  if(state.cart.length===0){ toast("Add items first"); return; }
  el("#checkoutModal").classList.add("open");
  const t = calcTotals();
  el("#orderSummary").innerHTML = `
    <hr>
    <div><strong>Order Summary</strong></div>
    <div class="row"><span>Items</span><span>${state.cart.reduce((s,i)=>s+i.qty,0)}</span></div>
    <div class="row"><span>Subtotal</span><span>${formatCurrency(t.subtotal)}</span></div>
    <div class="row"><span>Shipping</span><span>${formatCurrency(t.shipping)}</span></div>
    <div class="row total"><span>Total</span><span>${formatCurrency(t.total)}</span></div>
    <div class="small">By placing an order you agree to our Terms & Refund Policy.</div>
  `;
}
function closeCheckout(){ el("#checkoutModal").classList.remove("open"); }
el("#checkout").onclick = openCheckout;
el("#closeCheckout").onclick = closeCheckout;
el("#xCheckout").onclick = closeCheckout;
el("#cancelOrder").onclick = closeCheckout;

function currentPayMethod(){ return document.querySelector('input[name="pay"]:checked').value; }

el("#placeOrder").onclick = async ()=>{
  const name = el("#c_name").value.trim();
  const phone = el("#c_phone").value.trim();
  const address = el("#c_address").value.trim();
  const city = el("#c_city").value.trim();
  const pin = el("#c_pin").value.trim();
  if(!name || !phone || !address || !city || !pin){ toast("Please fill shipping details"); return; }
  const totals = calcTotals();
  const order = {
    id: "ORD" + Date.now(),
    items: state.cart.map(i=>({id:i.id,name:i.name,price:i.price,qty:i.qty})),
    totals,
    customer: {name,phone,address,city,pin},
    coupon: state.coupon || null,
    createdAt: new Date().toISOString()
  };
  const pm = currentPayMethod();
  if(pm==="cod"){ await placeCOD(order); }
  if(pm==="rzp"){ await placeRazorpay(order); }
};

async function placeCOD(order){
  const hist = JSON.parse(localStorage.getItem("orders")||"[]");
  hist.push(order);
  localStorage.setItem("orders", JSON.stringify(hist));
  const lines = [];
  lines.push(`New COD Order ${order.id}`);
  order.items.forEach(i=> lines.push(`• ${i.name} x${i.qty} = ${formatCurrency(i.price*i.qty)}`));
  lines.push(`Subtotal: ${formatCurrency(order.totals.subtotal)}`);
  lines.push(`Shipping: ${formatCurrency(order.totals.shipping)}`);
  lines.push(`Discount: ${formatCurrency(order.totals.discount)}`);
  lines.push(`Total: ${formatCurrency(order.totals.total)}`);
  lines.push(`Customer: ${order.customer.name}, ${order.customer.phone}`);
  lines.push(`${order.customer.address}, ${order.customer.city} - ${order.customer.pin}`);
  const wa = `https://wa.me/${OWNER_WHATSAPP}?text=${encodeURIComponent(lines.join("\n"))}`;
  window.open(wa, "_blank");
  document.getElementById("checkoutMsg").style.display="block";
  state.cart=[]; saveCart(); renderCart();
  setTimeout(()=>{ closeCheckout(); closeDrawer(); }, 600);
  toast("Order created 🎉");
}

async function placeRazorpay(order){
  if(!RAZORPAY_KEY){ toast("Add your Razorpay key first"); return; }
  const options = {
    key: RAZORPAY_KEY,
    amount: order.totals.total*100,
    currency: "INR",
    name: STORE_NAME,
    description: "Order " + order.id,
    prefill: { name: order.customer.name, contact: order.customer.phone },
    notes: { address: `${order.customer.address}, ${order.customer.city} - ${order.customer.pin}` },
    handler: function (response){
      const hist = JSON.parse(localStorage.getItem("orders")||"[]");
      hist.push({...order, payment:{gateway:"razorpay", ...response}});
      localStorage.setItem("orders", JSON.stringify(hist));
      document.getElementById("checkoutMsg").style.display="block";
      state.cart=[]; saveCart(); renderCart();
      setTimeout(()=>{ closeCheckout(); closeDrawer(); }, 600);
      toast("Payment success ✅");
    },
    modal: { ondismiss(){ toast("Payment cancelled"); } },
    theme: { color: "#B5965C" }
  };
  const rzp = new window.Razorpay(options);
  rzp.open();
}

// ===== Product Modal logic =====
function openProduct(id){
  const p = PRODUCTS.find(x=>x.id===id);
  if(!p) return;
  state.viewing = p; state.imgIndex = 0;

  el("#pm_title").textContent = p.name;
  const thumbs = (p.images||[]).map((src,idx)=>`<img src="${src}" data-thumb="${idx}" class="${idx===0?'active':''}" alt="thumb ${idx+1}">`).join("");
  const html = `
    <div class="gallery">
      <div class="main">
        <button class="backbtn" id="pm_back" aria-label="Back">←</button>
        <img id="pm_main" src="${cover(p)}" alt="${p.name}">
        <button class="navbtn left" id="pm_prev">‹</button>
        <button class="navbtn right" id="pm_next">›</button>
      </div>
      <div class="thumbs" id="pm_thumbs">${thumbs}</div>
    </div>
    <div>
      <div class="pmeta">
        <span class="chip">${p.category}</span>
      </div>
      <h2 class="titlelg" style="margin:8px 0 6px">${p.name}</h2>
      <div class="stock"><span class="dot"></span> In Stock (${p.stock ?? 10} available)</div>
      <div class="price" style="font-size:22px;margin-top:10px">${formatCurrency(p.price)}</div>
      <div class="pactions">
        <button class="btn" data-add="${p.id}">Add to cart</button>
        <button data-buy="${p.id}">Buy now</button>
        <button class="whatsapp" id="pm_whatsapp">Inquire via WhatsApp</button>
        <button class="sharebtn" id="pm_share" title="Share">🔗</button>
      </div>
    </div>`;
  el("#pm_body").innerHTML = html;

  // events
  el("#pm_prev").onclick = ()=> navImage(-1);
  el("#pm_next").onclick = ()=> navImage(1);
  el("#pm_thumbs").onclick = (e)=>{
    const t = e.target.closest("[data-thumb]");
    if(!t) return;
    state.imgIndex = Number(t.getAttribute("data-thumb"));
    updateMainImage();
  };
  el("#pm_whatsapp").onclick = ()=>{
    const text = `Hi, I'm interested in "${p.name}" (${formatCurrency(p.price)}).`;
    window.open(`https://wa.me/${OWNER_WHATSAPP}?text=${encodeURIComponent(text)}`,"_blank");
  };
  el("#pm_share").onclick = async ()=>{
    const text = `${p.name} - ${formatCurrency(p.price)}`;
    try{
      if(navigator.share){ await navigator.share({title:p.name,text, url: location.href}); }
      else { await navigator.clipboard.writeText(text); toast("Copied to clipboard"); }
    } catch(_){}
  };
  // NEW: back button closes the product modal
  el("#pm_back").onclick = closeProduct;

  el("#productModal").classList.add("open");
}
function closeProduct(){ el("#productModal").classList.remove("open"); }

function navImage(step){
  const imgs = state.viewing.images||[];
  if(!imgs.length) return;
  state.imgIndex = (state.imgIndex + step + imgs.length) % imgs.length;
  updateMainImage();
}
function updateMainImage(){
  const imgs = state.viewing.images||[];
  el("#pm_main").src = imgs[state.imgIndex] || cover(state.viewing);
  document.querySelectorAll("#pm_thumbs img").forEach((im,i)=> im.classList.toggle("active", i===state.imgIndex));
}

el("#closeProduct").onclick = closeProduct;
el("#xProduct").onclick = closeProduct;

// Quick utils
function toast(msg){
  let t = document.getElementById("toast");
  if(!t){
    t = document.createElement("div");
    t.id="toast";
    Object.assign(t.style,{
      position:"fixed",bottom:"16px",left:"50%",transform:"translateX(-50%)",
      background:"var(--text)",color:"var(--bg)",padding:"10px 14px",borderRadius:"10px",
      zIndex:9999,boxShadow:"0 8px 30px rgba(0,0,0,.25)",opacity:"0",transition:"opacity .2s"
    });
    document.body.appendChild(t);
  }
  t.textContent = msg; t.style.opacity="1";
  setTimeout(()=> t.style.opacity="0", 1500);
}
document.addEventListener("keydown",(e)=>{
  if(e.key==="Escape"){
    document.getElementById("drawer").classList.remove("open");
    document.getElementById("checkoutModal").classList.remove("open");
    document.getElementById("productModal").classList.remove("open");
  }
});
</script>
</body>
</html>



